/*! vizuly 23-06-2016 */
vizuly.viz.linearea=function(a){function b(){o=i.selection.append("svg").attr("id",i.id).style("overflow","visible").attr("class","vizuly"),t=o.append("rect").attr("class","vz-background"),w=vizuly.util.getDefs(k),A=w.append("clipPath").attr("id",i.id+"_plotClipPath").append("rect"),B=w.append("clipPath").attr("id",i.id+"_xClipPath").append("rect"),p=o.append("g").attr("class","vz-linearea-viz"),q=p.append("g").attr("class","vz-bottom-axis").attr("clip-path","url(#"+i.id+"_xClipPath)").append("g"),r=p.append("g").attr("class","vz-left-axis"),s=p.append("g").attr("class","vz-plot").attr("clip-path","url(#"+i.id+"_plotClipPath)"),u=s.append("rect").attr("class","vz-plot-background"),v=s.append("g").attr("class","vz-series"),x=p.append("g").attr("class","vz-point-areas"),i.dispatch.initialize()}function c(){k.validate(),l=vizuly.util.size(i.margin,i.width,i.height),"undefined"==i.xScale&&(i.xScale=vizuly.util.getTypedScale(k.x()(i.data[0][0])));var a=i.layout==vizuly.viz.layout.STACKED?"reverse":i.layout==vizuly.viz.layout.STREAM?"wiggle":"none";n=d3.layout.stack().values(function(a){return a}).x(function(a){return i.x(a)}).y(function(a){return i.y(a)}).out(function(b,c,d){b.y0="none"==a?0:c,b.y=d}).order("reverse").offset(a),n(i.data),i.yScale.domain([0,d3.max(i.data,function(a){return d3.max(a,function(a){return Number(i.y(a)+a.y0)})})]),"string"==typeof k.x()(i.data[0][0])?i.xScale.domain(i.data[0].map(function(a){return i.x(a)})):i.xScale.domain([d3.min(i.data[0],function(a){return i.x(a)}),d3.max(i.data[0],function(a){return i.x(a)})]),vizuly.util.setRange(i.yScale,l.height,0),vizuly.util.setRange(i.xScale,0,l.width),z.interpolate(i.interpolate).x(function(a){return i.xScale(i.x(a))}).y0(function(a,b){return i.yScale(a.y0)}).y1(function(a,b){return i.yScale(i.y(a)+a.y0)}),y.interpolate(i.interpolate).x(function(a){return i.xScale(i.x(a))}).y(function(a,b){return i.yScale(i.y(a)+a.y0)}),i.xAxis.scale(i.xScale).orient("bottom"),i.yAxis.scale(i.yScale).orient("left"),m=Math.min(l.width/50,l.height/50),e(),i.dispatch.measure()}function d(){c(),o.attr("width",i.width).attr("height",i.height),t.attr("width",i.width).attr("height",i.height),A.attr("width",l.width).attr("height",l.height),B.attr("width",l.width).attr("height",i.height-l.height).attr("transform","translate("+l.left+","+l.height+")"),s.style("width",l.width).style("height",l.height).attr("transform","translate("+l.left+","+l.top+")"),x.style("width",l.width).style("height",l.height).attr("transform","translate("+l.left+","+l.top+")"),q.attr("transform","translate("+l.left+","+(l.height+l.top+3)+")"),r.attr("transform","translate("+l.left+","+l.top+")"),u.attr("width",l.width).attr("height",l.height);var a=v.selectAll(".vz-series-plots").data(i.data);a.enter().append("g").attr("class","vz-series-plots"),a.exit().remove(),a.each(function(a,b){var c=d3.select(this),d=c.selectAll(".vz-line").data([a]);d.enter().append("path").attr("class","vz-line"),d.exit().remove(),d.transition().duration(i.duration).attr("d",function(a,b){return y(a)});var e=c.selectAll(".vz-area").data([a]);e.enter().append("path").attr("class","vz-area"),e.exit().remove(),e.transition().duration(i.duration).attr("d",function(a,b){return z(a)})}),x.selectAll(".vz-tip").remove(),i.data.forEach(function(a,b){var c=x.selectAll("vz-tip").data(a).enter().append("g").attr("class","vz-tip").attr("transform",function(a,b){return"translate("+i.xScale(i.x(a))+","+i.yScale(i.y(a)+a.y0)+")"}).on("mouseover",function(a,c){i.dispatch.mouseover.apply(this,[a,c,b])}).on("touchstart",function(a,c){i.dispatch.mouseover.apply(this,[a,c,b])}).on("mouseout",function(a,c){i.dispatch.mouseout.apply(this,[a,c,b])}).on("mousedown",function(a,c){i.dispatch.mousedown.apply(this,[a,c,b])});c.each(function(){var a=d3.select(this);a.append("circle").attr("class","vz-hit-circle").style("fill","#FFF").style("stroke",null).style("opacity",.001).transition().attr("r",m)})}),q.call(i.xAxis),r.call(i.yAxis),i.dispatch.update()}function e(){i.zoom||(i.zoom=d3.behavior.zoom().x(i.xScale).scaleExtent([1,10]).on("zoomstart",g).on("zoomend",h).on("zoom",f),s.call(i.zoom)),i.zoom.scale(1).translate([0,0]),A.attr("width",l.width).attr("height",l.height),B.attr("width",l.width).attr("height",i.height-l.height).attr("transform","translate("+l.left+","+l.height+")")}function f(){if(!C){var a=i.zoom.translate(),b=a[0],c=a[1];b=Math.min(b,0),b=Math.max(b,l.width-l.width*i.zoom.scale()),i.zoom.translate([b,c]),s.selectAll(".vz-series-plots").each(function(a,b){var c=d3.select(this);c.selectAll(".vz-line").attr("d",function(){return y(a)}),c.selectAll(".vz-area").attr("d",function(){return z(a)})}),s.selectAll(".vz-series-tips").each(function(a,b){var c=d3.select(this);c.selectAll(".vz-data-point").attr("cx",function(a,b){return i.xScale(i.x(a))})}),q.call(i.xAxis),i.dispatch.zoom()}}function g(){var a=d3.event.sourceEvent.target;"vz-hit-circle"==d3.select(a).attr("class")?C=a:(C=null,x.style("display","none")),A.attr("width",l.width),B.attr("width",l.width).attr("height",i.height-l.height).attr("transform","translate("+l.left+","+l.height+")"),i.dispatch.zoomstart()}function h(){x.selectAll(".vz-tip").attr("transform",function(a,b){return"translate("+i.xScale(i.x(a))+","+i.yScale(i.y(a)+a.y0)+")"}),x.style("display","block"),C=null,i.dispatch.zoomend()}var i={},j={data:null,layout:vizuly.viz.layout.OVERLAP,margin:{top:"10%",bottom:"7%",left:"9%",right:"7%"},duration:500,width:300,height:300,x:null,y:null,xScale:"undefined",yScale:d3.scale.linear(),xAxis:d3.svg.axis(),yAxis:d3.svg.axis(),interpolate:"linear"},k=vizuly.component.create(a,i,j);k.type="viz.chart.linearea";var l,m,n,o,p,q,r,s,t,u,v,w,x,y=d3.svg.line(),z=d3.svg.area();b(),k.update=function(){return d(),k},i.zoom=null,k.zoom=function(a){return arguments.length?(i.zoom=a,void f()):i.zoom};var A,B,C=null;return k};