/*! vizuly 21-03-2016 */
vizuly.component.column=function(a){function b(){n=g.selection.append("svg").attr("id",g.id).style("overflow","visible").attr("class","vizuly"),t=n.append("rect").attr("class","vz-background"),v=vizuly.util.getDefs(i),w=v.append("clipPath").attr("id",g.id+"_plotClipPath").append("rect"),x=v.append("clipPath").attr("id",g.id+"_xClipPath").append("rect"),o=n.append("g").attr("class","vz-column-viz"),p=o.append("g").attr("class","vz-bottom-axis").attr("clip-path","url(#"+g.id+"_xClipPath)").append("g"),q=o.append("g").attr("class","vz-left-axis"),r=o.append("g").attr("class","vz-plot").attr("clip-path","url(#"+g.id+"_plotClipPath)"),u=r.append("rect").attr("class","vz-plot-background").style("fill","#FFF").style("fill-opacity",.01),g.dispatch.initialize()}function c(){i.validate(),j=vizuly.util.size(g.margin,g.width,g.height),l=j.width/g.data[0].length*(1-g.padding),k=l/g.data.length*(1-g.padding),g.layout==vizuly.component.layout.STACKED&&(m=d3.layout.stack().values(function(a){return a}).x(function(a){return g.x(a)}).y(function(a){return g.y(a)}).out(function(a,b,c){a.y0=b}).order("reverse"))(g.data),g.yScale.domain([0,d3.max(g.data,function(a){return d3.max(a,function(a){return g.y(a)+(g.layout==vizuly.component.layout.STACKED?a.y0:0)})})]),"string"==typeof g.x(g.data[0][0])?g.xScale.domain(g.data[0].map(function(a){return g.x(a)})):g.xScale.domain([d3.min(g.data[0],function(a){return g.x(a)}),d3.max(g.data[0],function(a){return g.x(a)})]),vizuly.util.setRange(g.yScale,j.height,0),vizuly.util.setRange(g.xScale,0,j.width),g.xAxis.scale(g.xScale).orient("bottom"),g.yAxis.scale(g.yScale),e(),g.dispatch.measure()}function d(){c(),n.attr("width",g.width).attr("height",g.height),t.attr("width",g.width).attr("height",g.height),w.attr("width",j.width).attr("height",j.height),x.attr("width",j.width).attr("height",g.height-j.height).attr("transform","translate("+(j.left+k*g.padding)+","+j.height+")"),r.style("width",j.width).style("height",j.height).attr("transform","translate("+(j.left+k)+","+j.top+")"),p.attr("transform","translate("+(j.left+k*g.padding)+","+(j.height+j.top)+")"),q.attr("transform","translate("+j.left+","+j.top+")"),u.attr("width",j.width).attr("height",j.height),s=r.selectAll(".vz-bar-group").data(g.data[0]),s.enter().append("g").attr("class","vz-bar-group"),s.exit().remove(),s.each(function(a,b){var c=d3.select(this).selectAll(".vz-bar").data(g.data.map(function(a){return a[b]}));c.enter().append("rect").attr("class","vizuly vz-bar").attr("x",function(a,b){return b*(k+k*g.padding)}).attr("height",0).attr("y",j.height).on("mouseover",function(a,b){g.dispatch.mouseover(this,a,b)}).on("mouseout",function(a,b){g.dispatch.mouseout(this,a,b)}).on("click",function(a,b){g.dispatch.click(this,a,b)}).on("touch",function(a,b){g.dispatch.touch(this,a,b)}),c.exit().remove(),g.layout==vizuly.component.layout.STACKED?c.transition().duration(g.duration).attr("x",0).attr("width",l).attr("height",function(a,b){return j.height-g.yScale(g.y(a))}).attr("y",function(a,b){return g.yScale(a.y0+g.y(a))}):c.transition().duration(g.duration).attr("x",function(a,b){return b*(k+k*g.padding)}).attr("width",k).attr("height",function(a,b){return j.height-g.yScale(g.y(a))}).attr("y",function(a,b){return g.yScale(g.y(a))})}),s.attr("transform",function(a,b){return"translate("+g.xScale(g.x(a))+",0)"}),p.call(g.xAxis),q.call(g.yAxis),g.dispatch.update()}function e(){g.zoom||(g.zoom=d3.behavior.zoom().scaleExtent([1,10]).on("zoomstart",function(){w.attr("width",j.width),x.attr("width",j.width).attr("height",g.height-j.height).attr("transform","translate("+(j.left+k*g.padding)+","+j.height+")"),g.dispatch.zoomstart()}).on("zoom",f),r.call(g.zoom)),g.zoom.scale(1).translate([0,0]),w.attr("width",j.width).attr("height",j.height),x.attr("width",j.width).attr("height",g.height-j.height).attr("transform","translate("+(j.left+k*g.padding)+","+j.height+")")}function f(){var a=d3.event?d3.event.translate[0]:g.zoom.translate()[0];a<-(g.zoom.scale()*j.width)+j.width?a=-(g.zoom.scale()*j.width)+j.width:a>0&&(a=0),vizuly.util.setRange(g.xScale,0,Math.round(j.width*g.zoom.scale())),s.attr("transform",function(b,c){return"translate("+(a+g.xScale(g.x(b)))+",0)"}).selectAll(".vz-bar").attr("x",function(a,b){return g.layout==vizuly.component.layout.STACKED?0:b*(k*g.zoom.scale()+k*g.zoom.scale()*g.padding)}).attr("width",function(a,b){return g.layout==vizuly.component.layout.STACKED?l*g.zoom.scale():k*g.zoom.scale()}),p.attr("transform","translate("+(j.left+k*g.padding+a)+","+(j.height+j.top)+")"),p.call(g.xAxis),g.dispatch.zoom()}var g={},h={data:null,layout:vizuly.component.layout.CLUSTERED,margin:{top:"10%",bottom:"7%",left:"9%",right:"7%"},duration:500,width:300,height:300,padding:.1,x:null,y:null,xScale:d3.scale.ordinal(),yScale:d3.scale.linear(),xAxis:d3.svg.axis(),yAxis:d3.svg.axis()},i=vizuly.viz.create(a,g,h);i.type="viz.chart.column";var j,k,l,m,n,o,p,q,r,s,t,u,v;b(),i.update=function(){return d(),i},g.zoom=null,i.zoom=function(a){return arguments.length?(g.zoom=a,void f()):g.zoom};var w,x;return i};